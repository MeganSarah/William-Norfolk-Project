---
title: "Unsupervised Learning Analysis"
author: "William Norfolk"
date: "11/18/2019"
output: word_document
---

This script uses unsupervised modeling to determine similaraity characteristics between individual sampling sites, as well as uses cluster analysis to measure similarity of year to year measures. 

Start by loading required libraries
```{r load libs}
library(readxl)
library(dplyr)
library(tidyverse)
library(forcats)
library(ggthemes)
library(knitr)
library(naniar)
library(broom)
library(gridExtra)
library(ggpubr)
library(visdat)
library(factoextra)
library(dendextend)
library(cluster)
library(NbClust)
library(mclust)

#Note it will be very important to call functions using the :: library notation due to the frequency of function masking by our libraries. 

```

Next load the data a take a look.

```{r view data}

WQ_clean_data <- readRDS("../../data/processed_data/processeddata.rds")

glimpse(WQ_clean_data)
```


## Unsupervised Cluster Analysis

Since our data is not specifically targeted at particular outcome (i.e. occurance of disease, algal bloom, etc.) and focuses more as a monitoring program; it may be best to use unsupervised modeling techniques to to cluster our data. We will use agglomerative clustering to explore the data for various cluster patterns. Agglomerative clustering works in a bottom-up fashion, each individual object within a data set is considered a distinct cluster (leaves) initially and is grouped to the nearest cluster (via the input variables) at each step of the algorithm until all data is in a single big cluster (root) thus producing a dendrogram. The inverse of agglomerative clustering is called divisive cluster analysis and works opposite from a root to leaf manner. Divisive clustering is acomplished through the function diana() and is used substantially less in analyses than agnes(). We will compare a diana() cluster to agnes() and hclut() below. 

### Questions for this Analysis

_How do sampling sites cluster based on individual water quality measurements?_ 
_Are there any site-wise, annual, and/or seasonal patterns that can be identified based on cluster analysis?_ 

First we must remove any NAs from our data as cluster functions cannot handle them. Additionally, we need to select our branch outcome (in this case location) as well as our five numeric water quality parameters of interest. 
```{r select vars and remove nas}

cluster_trim <- WQ_clean_data %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)

cluster_trim <- na.omit(cluster_trim)


```



We will cluster by site means to produce a readable dendrogram.

With a retrospective view, there are four locations which will greatly skew our data when producing a dendrogram. All four locations have a single measure comprising the data for site. When allowed to remain in our sample set these data points force our dendrogram to subdivide further grouping themselves into indivual clusters. Though this information is interesting, considering the n of each of these locations and the large impact they play on the final dendrogram, we will remove them here to produce a generalized view of the clusters. 

In addition to pruning, all data must be scaled so it can be accurately compared across multiple variables. Each of our water quality parameters have a different scale of measure (i.e. temperature is relatively variable from approximately 10 degrees to 40 degrees, where as ammonia is very narrow from 0 to 1 mg/L). The variability among the scales of the variables would skew the results to to very strongly express those with greater differences (likely temperature and salinity). To ensure all variables are accounted for correctly we will use the scale function which subtracts the mean from each observation then divides by the standard deviation. This allows variables which are measured on different scales to be compareable for clustering. 

```{r aggregate and remove outliers}

location_average <- aggregate(. ~ location, cluster_trim, mean)

drop_buttonwood <- location_average[!location_average$location == "Buttonwood", ]
drop_orc <- drop_buttonwood[!drop_buttonwood$location == "Ocean Reef Club", ]
drop_lagoon <- drop_orc[!drop_orc$location == "Lagoon", ]
drop_hidden <- drop_lagoon[!drop_lagoon$location == "Hidden Lake", ]
drop_NA_site <- drop_hidden[!drop_hidden$location == "NA", ]#There is also a site listed as NA we must remove

#set rownames to the locations names, then the location variable must be dropped to eliminate any non-numeric variables in the dataframe. 
rownames(drop_NA_site) <- drop_NA_site$location

drop_location <- drop_NA_site %>% dplyr::select(-location)

#Scale the data so all variables are compareable, after using the scale function you must convert the resulting object back to a data fram for further analysis
cluster_ready <- scale(drop_location, center = TRUE, scale = TRUE)

cluster_ready <- as.data.frame(cluster_ready)
```

Next we produce the dendrograms with the code below. We will use three different cluster methods hclust, agnes, and diana to compare the results initially. hclust and agnes will preform agglomerative cluster analysis and diana will preform divisive cluster analysis. 

Note prior preforming agglomerative clustering we must first compute a dissimilarity martix to determine how different individual observations are from one another, this is acomplished with the dist() function for the hclust function and is built into the functions agnes and diana. 


```{r mean all site dendrogram}

set.seed(1111) #Ensure reproducible

#rownames(cluster_ready) <- cluster_ready$location #Assign the location names to rownames to produce dendrograms that show site information.

cluster_diss <- dist(cluster_ready, method = "euclidean") #For the hclust function we must first produce a dissimilarity matrix before runing cluster analysis


cluster_site_hclust <- hclust(cluster_diss, method = "ward.D") #Hierarchial clustering with Ward's minimum variance
cluster_site_agnes <- agnes(cluster_ready, method = "ward") #Agglomerative clustering with Ward's minimum variance
cluster_site_diana <- diana(cluster_ready) #Divisive clustering is similar to the agnes function, however no method is needed to provide to this function

#Plot the trees. Note agnes can use pltree or plot but hclust must use plot
good_tree_hclust <- plot(cluster_site_hclust, cex = 0.6, hang = -1, main = "Agglomerative (hclust) Dendrogram of Sample Locations")
good_tree_agnes <- pltree(cluster_site_agnes, cex = 0.6, hang = -1, main = "Agglomerative (agnes) Dendrogram of Sample Locations")
good_tree_diana <- pltree(cluster_site_diana, cex = 0.6, hang = -1, main = "Divisive Dendrogram of Sample Locations")


```

So it looks like all three dendrograms look fairly different. There are no very distinct patterns that jump out immediately but we will need to do a bit more analysis to learn our optimal cluster number (k) before we can really start to interpret the results. 

Our primary question is targeted at determining how different individual sampling site locations are from one another. While our sites represent an array of different habitat types, we are interested in clustering locations by the specific abiotic conditions of the locale. Since our question is looking at these small specific differences we will use agglomerative clustering for the duration of the analysis as this method is better suited for identifying small clusters. Agglomerative clustering uses a more exhaustive algorithm (pairs at each iteration and upon completion) to make comparisons so it is generally better with small differences in data however, this is a trade-off for computational ability. Since our dataset is fairly small and computationally easy this will not be an issue. For larger datasets divisive clustering would be the more efficent choice. 

Before moving on we will check our agglomerative method. We started with Ward's minimum variance method however there are others we could use (single, complete, and average). We will calculate the agglomerative coefficent for each below. A coefficent closer to 1 indicates a stronger clustering. 
```{r warning = FALSE}
cluster_site_agnes$ac

methods <- c( "average", "single", "complete", "ward")
names(methods) <- c( "average", "single", "complete", "ward")

#Note we must use agnes to get the agglomerative coefficent as hclust objects do not permit this function
coeff <- function(x) {
  agnes(cluster_ready, method = x)$ac
}

map_dbl(methods, coeff)
```

It looks like Ward's method is the best option so we will keep that for all future clusters to be consistent.

Next we will check our optimal number of clusters. There are two available methods to check for optimal clusters wss and silhouette. These functions work with cluster algorithms to determine the ideal k value for samples. The wss (within-cluster sum of squares) or "Elbow Method" measures the compactness of clustering with the within cluster sum of squares, a smaller wss equals the optimal cluster numbers. The wss plot produced by the function shows a curve where the Elbow in the the curve is the optimal clusters. The silhouette method uses the average silhouette to determine how well an object lies in a cluster. There greater avaerage silhouette the more optimal the cluster level is. 


```{r}
set.seed(1111)

fviz_nbclust(cluster_ready, FUN = hcut, method = "silhouette", print.summary = TRUE)
fviz_nbclust(cluster_ready, FUN = hcut, method = "wss", print.summary = TRUE)

```
It looks like five clusters is the optimal number for both the wss and silhouette methods so we will use this k value to produce our good dendrograms for the manuscript. 


Before moving to the next code set.
Just a quick code bit to count the number of values in each cluster.This is more useful if there is a very high number of branches.
```{r}
sub_group_dendro_1 <- cutree(cluster_site_agnes, k = 5)

table(sub_group_dendro_1)


```

Looks like one of our clusters is substantially larger than the rest of the of the clusters. Ideally we can find a common factor between these location points which we cna interpret. 


Next for fun we will visualize our data as a scatter cluster plot. 

```{r}


add_cluster_groups <- cluster_ready %>% dplyr::mutate(cluster = sub_group_dendro_1)



cluster_site <- agnes(add_cluster_groups, method = "average")

cluster_data <- add_cluster_groups[, c(2:6)]

#Uncomment to add names to plot (the look is confusing in this situation)
rownames(add_cluster_groups) <- cluster_ready$location



fviz_cluster(list(data = cluster_data, cluster = sub_group_dendro_1))

```

Looks like our clusters are relatively distinct with a little overlap between 1 and 2. Five may be a cluster to keep an eye on as it is very small, but it is possible that cluster contains two sites which are very different from others in the data set. 

Next lets make a nice dendrogram.

```{r}


sample_site_dendro_agnes <- fviz_dend(cluster_site_agnes, k = 5, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Agglomerated Dendrogram (agnes) by Sample Site")

sample_site_dendro_agnes

sample_site_dendro_hclust <- fviz_dend(cluster_site_hclust, k = 5, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Agglomerated Dendrogram (hclust) by Sample Site")

sample_site_dendro_hclust
```

Now that we can better visualize differences it looks like our two agglomerative dendrograms are very similar (which is good news!) the hclust function and agnes functions are slightly different in practice so it is not out of the question to see small differences in the results. 

Based on this dendrogram it looks like the most similar sites visited by MarineLab in terms of water quality data are: Key Largo Dry Rocks & Grecian Dry Rocks and Scott's Channel & Banana. The former pair are two sites which are adjacent to one another on the reef line so this is expected. The latter pair are highly different sites both geograpically and biologically so this is an interesting match. Looking at differences there are no individual sites which stand out a distinctly different from others within the data set. The two major divisions of the dendrogram (blue/purple and red/yellow/green) show a little favoritism between Seagrass/Mangrove and not. The majority of Seagrass/Mangrove sites are found in the red/yellow/green branch whereas the majority of Coral reefs are in the blue/purple division however, this situation is not consistent for all sites within each type. Patch Reef/Hardbottom sites appear sporadically in the clusters. 

We can check the similarity of these two dendrograms by using a tanglegram. A tanglegram compares the alignment of two dendrograms (the must have the same information and number of samples) to show how entangled they are. The greater the entanglemnt (closer to 1) the less similar the two dendrograms are. Matching nodes in each dendrogram are connected by a colored line which corresponds to the cluster location, unmatched nodes are black, these represent disagreement between the two dendrograms. 

```{r}
p <- as.dendrogram(cluster_site_agnes)
q <- as.dendrogram(cluster_site_hclust)

all_site_dend <- dendlist(q, p)


xx <- tanglegram(cluster_site_hclust, cluster_site_agnes, highlight_distinct_edges = FALSE, common_subtrees_color_branches = FALSE, lwd = 2, k_branches = 5, lab.cex = 0.7, main = paste("All Sites (hclust vs agnes) Entanglement =", round(entanglement(all_site_dend), 2)))

all_site_dend %>% untangle("step1side") %>% tanglegram()
```
From the tanglegram it looks like most of our sites are in agreement between the two methods. Most of the disagreement appears to be within the 5 major clusters (i.e. disagreement about where in the cluster exaclty the site belongs) which are relatively minor. The only large difference is the Elbow site which jumps clustering with the different alogrithms, it will be important to keep an eye on this location.

### Unsupervised Modeling Discussion

The unsupervised method of modeling allows us to see data clusters that occur as a result of the input variables. This type of analysis is very useful for datasets like ours where no defined outcome is a componet. From this type of analysis we can determine which sites (or other assigned criteria) are most similar across the dataset due to changes in the input variables. 

However, this analysis is not without limiation. While the clustering provides important information, clustering does not explain why the data is grouped in a particular pattern. Water quality measuares feed into the model which in turn influence the decisions of the clustering however, this type of model cannot account for any external factors (unless previously controlled) which influence the variables (such as seasonality and annual variance). In the absence of a visible pattern of clustering attributable to some known characteristic of the sites (i.e. type, depth, season, distance from shore, etc) the cluster groups are relatively uninfomative beyond showing which are the most similar. This is an issue we have seen with our analysis above. Small patterns of site data can be seen within individual branches however, no overall pattern of clustering can be seen which applies to all sites.

This result is not entirely uninformative, this suggests that site clustering may be strongly affected by additional factors (which we will explore below) and/or water quality parameters are simply not powerful enough to distinguish these sites either entirely or through the usage of the tools employed by MarineLab. 

To explore some more depths of our dataset we will subset the cleaned data to target specific aspects of the analyis in effort to visualize additional patterns which cannot be seen using the total data. These results are shown in the sections below.

## Site Type Clustering

Now that we have the overall dendrogram for each site lets compare our three site types individuall and see how different each of them are from one another. For this analysis we will use average values for each parameter as we did above and compare clustering for Seagrass/Mangrove, Patch Reef/Hardbottom, and Coral Reef sites respectively.

### Questions for this section

_Which of the three site types (Seagrass/Mangrove, Patch Reef/Hardbottom, or Coral Reef) are the most homogeneous and heterogeneous?_

_Are there any notable site patterns which might explain why the clusters are distributed in this manner?_

First we need to subset data from the clean data, select our predictors, remove any NAs in the predictors, and finally aggregate the means of each site.
```{r clean data for site type clustering}

#Subset the sites
sg_mg_subset <- subset(WQ_clean_data, site_type == "Seagrass/Mangrove")
#We will drop the same observations again as we did in the above cluster analysis
sg_mg_redrop1 <- sg_mg_subset[!sg_mg_subset$location == "Buttonwood", ]
sg_mg_redrop2 <- sg_mg_redrop1[!sg_mg_redrop1$location == "Lagoon", ]
sg_mg_redrop3 <- sg_mg_redrop2[!sg_mg_redrop2$location == "Hidden Lake", ]

pr_h_subset <- subset(WQ_clean_data, site_type == "Patch Reef/Hardbottom")
cr_subset <- subset(WQ_clean_data, site_type == "Coral Reef")

#Reduce the data to the predictors of interest
sg_mg_reduce <- sg_mg_redrop3 %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)
pr_h_reduce <- pr_h_subset %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)
cr_reduce <- cr_subset %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)


#Drop any NAs
sg_mg_ready <- na.omit(sg_mg_reduce)
pr_h_ready <- na.omit(pr_h_reduce)
cr_ready <- na.omit(cr_reduce)

#Aggregate to get the mean value for each variable at each location
sg_mg_ready <- aggregate(. ~ location, sg_mg_ready, mean)
pr_h_ready <- aggregate(. ~ location, pr_h_ready, mean)
cr_ready <- aggregate(. ~ location, cr_ready, mean)

#Assign rownames as the site names
rownames(sg_mg_ready) <- sg_mg_ready$location
rownames(pr_h_ready) <- pr_h_ready$location
rownames(cr_ready) <- cr_ready$location

#Drop the location variable then scale the data to normalize and finally convert back to a data frame
sg_drop_location <- sg_mg_ready %>% dplyr::select(-location)
sg_scale <- scale(sg_drop_location)
sg_mg_ready <- as.data.frame(sg_scale)

pr_h_drop_location <- pr_h_ready %>% dplyr::select(-location)
pr_h_scale <- scale(pr_h_drop_location)
pr_h_ready <- as.data.frame(pr_h_scale)

cr_drop_location <- cr_ready %>% dplyr::select(-location)
cr_scale <- scale(cr_drop_location)
cr_ready <- as.data.frame(cr_scale)

```


Now we can make our dendrograms, we will start with Seagrass/Mangrove. First we will determine our optimal number of clusters for analysis.

```{r check clusters SG/MG}

fviz_nbclust(sg_mg_ready, FUN = hcut, method = "silhouette")
fviz_nbclust(sg_mg_ready, FUN = hcut, method = "wss")

```

Five clusters it is! Now we can make our good dendrogram!


```{r good dendro SG/MG}
set.seed(1111)

sg_mg_clust <- agnes(sg_mg_ready, method = "ward")

#Note this code produces a raw dendrogram where as the fviz_dend function allows for tuning and modification for publication/manuscript usage
sg_mg_dend <- pltree(sg_mg_clust, cex = 0.6, hang = -1, main = "SG/MG Test")

sg_mg_good_dend <- fviz_dend(sg_mg_clust, k = 5, show_labels = TRUE, cex = 0.6, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Seagrass/Mangrove Agglomerative Cluster Analysis")

sg_mg_good_dend


```
It looks like our Seagrass/Mangrove sites are reasonably distinct! It is unsprising that Nest Key is given a distinct cluster due to the fact that this site is very geographically different from all other sampling locations in the data set. Beyond this seperation, there are not noticable distinct patterns in the data. The lack of notable correlation may be due to the fact that Seagrass/Mangrove sites tend to be the most variable in terms of conditions and seasonality may be a stronger influencer of water quality parameters. 

Lets take a look at patch reefs and hardbottom sites.

Cluster evaluation with the silhouette and wss method (as we have done for all samples) is not possible for the Patch Reef/Hardbottom data due to the fact that the number of observations is too low to use the function. We will use the NbClust function to compute the silhouette index and determine the best number of clusters. Note this method will not produce a silhouette curve but will still provide the ideal cluster number in the output.
```{r}
#A min and max number of clusters must be supplied in this function. We will use a 2 min to ensure we get some informaiton and a max of 6 as the highest max must be n-1
pr_h_diss <- NbClust(pr_h_ready, distance = "euclidean", min.nc = 2, max.nc = 6, method = "ward.D2", index = "silhouette")

#The code below provides the best number of columns, silhouette index, and partition of observations into clusters
pr_h_diss$Best.nc
pr_h_diss$Best.partition
```

```{r}
set.seed(1111)

pr_h_clust <- agnes(pr_h_ready, method = "ward")

pr_h_dend <- pltree(pr_h_clust, cex = 0.6, hang = -1, main = "Patch Reef/Hardobttom Test", labels = pr_h_ready$location)

pr_h_good_dend <- fviz_dend(pr_h_clust, k = 6, show_labels = TRUE, cex = 0.6, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Patch Reef/Hardbottom Cluster Analysis")

pr_h_good_dend
```

It looks like our Patch Reef/Hardbottom sites are very distinct across the majority of samples. This is likely due to the fact that all of these sites are distant from each other, this also my be sue to sampling bias as these sites are visited the lest frequently of all the three site types due to weather inaccessibility.

Lastly lets investigate Coral Reefs.

```{r}
fviz_nbclust(cr_ready, FUN = hcut, method = "silhouette")
fviz_nbclust(cr_ready, FUN = hcut, method = "wss")

```

Looks like ideal clustering is a bit less obvious this time around. We will use two for our analysis.

```{r}
set.seed(1111)

cr_clust <- agnes(cr_ready, method = "ward")

cr_dend <- pltree(cr_clust, cex = 0.6, hang = -1, main = "Coral Reef Cluster Test", labels = cr_ready$location)

cr_good_dend <- fviz_dend(cr_clust, k = 2, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Coral Reef Cluster Analysis")

cr_good_dend
```

Coral Reef clustering shows two distinct clusters, the The Elbow and Ocean Reef Club represent the two northernmost sites in our data set so it is interesting to see them seperated from the remained of the reef. All other sites are fairly variable. There is so clustering that appears to be geographically inclied (Key Kargo Dry Rocks & North North Dry Rocks as well as French Reef & Banana). Additionally, the clustering of Horseshoe and Grecian rocks may be due to depth similarity. 


Overall, our site clustering did not show a consistent pattern of grouping across all samples of site types. Notably, the most similar/dissimilar sites in the early clusters often can be linked by a similar characteristic such as: geographical location, similar biota, water depth, etc.

For Seagrass/Mangrove our most similar site pair was Pelican Key and Bush Point. These two sites are quite dissimilar from each other interms of location and biota, however they are the most favorable sites for winter wind direction. It is possible this clustering is due to a bias for winter sampling. The most distinct site was Nest Key which is geographically the furthest Seagras/Mangrove site from any of the other sites in the data set.

For Patch Reef/Hardbottom there was a wide range of dissimilarirty. The most similar sites were Higdon's and Mosquito. These two sites are almost exactly the same distance from shore and as a result have very similar coral biota as the primary reef structure. In terms of distance, Marker 37 is the most distinct site. Marker 37 is geographically distant from many of the other sites (and is probably closer to a Coral Reef location than other Patch Reefs). It should be noted that many sites were fairly distinct in this sampling set which shows that these locations are the most variable. This may be in part due to substantially lower sampling values for these sites due to inaccessibility. 

For Coral Reefs the most similar site pairs are Horseshoe & Grecian Rocks as well as North North Dry Rocks (NNDR) and Key Largo Dry Rocks (KLDR). NNDR and KLDR are two reef sites which are adjacent to each other on the reef line so this result is unsuprising. Horseshoe and Grecian are not as close (Grecian is actually closest to KLDR) however these two sites are highly similar in depth (shallower) which may explain this clustering. The most distinct sites in this subset are Ocean Reef Club and The Elbow both of which are the northernmost sites for all Coral Reef locations. 


## Year-to-Year Comparison

### Questions for this section
_How does our cluster analysis compare across sampling years?_


We will make a comparison across years using a tanglegram to see how clustering of invividual site locations compares across the ~4 years of study. 

First we must subset our data into years and normalize our locations so we only have repedative locations for each dendrogram.

```{r prep year data and predictors}
#Subset into individual years
year_16 <- subset(WQ_clean_data, Year == "16")
year_17 <- subset(WQ_clean_data, Year == "17")
year_18 <- subset(WQ_clean_data, Year == "18")
year_19 <- subset(WQ_clean_data, Year == "19")

#Remove NAs
year_16 <- na.omit(year_16)
year_17 <- na.omit(year_17)
year_18 <- na.omit(year_18)
year_19 <- na.omit(year_19)

#Select predictors
year_16 <- year_16 %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)
year_17 <- year_17 %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)
year_18 <- year_18 %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)
year_19 <- year_19 %>% dplyr::select(location, water_temp, salinity, dissolved_oxygen, ammonia, ph)

#Aggregate the sample sites by mean of each water quality variable
year_16 <- aggregate(. ~ location, year_16, mean)
year_17 <- aggregate(. ~ location, year_17, mean)
year_18 <- aggregate(. ~ location, year_18, mean)
year_19 <- aggregate(. ~ location, year_19, mean)

#Assign the location to the rowname
rownames(year_16) <- year_16$location
rownames(year_17) <- year_17$location
rownames(year_18) <- year_18$location
rownames(year_19) <- year_19$location

```

```{r 2016}

#Remove all rows that are not present in all four years of study
year_16 <- year_16[!year_16$location == "Scott's Channel", ]
year_16 <- year_16[!year_16$location == "Sexton Cove", ]
year_16 <- year_16[!year_16$location == "Ocean Reef Club", ]
year_16 <- year_16[!year_16$location == "North North Dry Rocks", ]
year_16 <- year_16[!year_16$location == "NA", ]
year_16 <- year_16[!year_16$location == "Higdon's", ]
year_16 <- year_16[!year_16$location == "The Elbow", ]
year_16 <- year_16[!year_16$location == "The Barge", ]
year_16 <- year_16[!year_16$location == "Bayside", ]
year_16 <- year_16[!year_16$location == "Blackwater Sound", ]
year_16 <- year_16[!year_16$location == "Benny Poo", ]
year_16 <- year_16[!year_16$location == "French Reef", ]
year_16 <- year_16[!year_16$location == "Deep Blue", ]
year_16 <- year_16[!year_16$location == "Marker 37", ]
year_16 <- year_16[!year_16$location == "Lagoon", ]
year_16 <- year_16[!year_16$location == "Tarpon Deep", ]
year_16 <- year_16[!year_16$location == "Mosquito", ]

#Remove the location variable, scale the data to normalize, and return back to a data frame
year_16 <- year_16 %>% dplyr::select(-location)
year_16 <- scale(year_16)
year_16 <- as.data.frame(year_16)


```

```{r 2017}

year_17 <- year_17[!year_17$location == "Scott's Channel", ]
year_17 <- year_17[!year_17$location == "Sexton Cove", ]
year_17 <- year_17[!year_17$location == "Ocean Reef Club", ]
year_17 <- year_17[!year_17$location == "North North Dry Rocks", ]
year_17 <- year_17[!year_17$location == "NA", ]
year_17 <- year_17[!year_17$location == "Higdon's", ]
year_17 <- year_17[!year_17$location == "The Elbow", ]
year_17 <- year_17[!year_17$location == "The Barge", ]
year_17 <- year_17[!year_17$location == "Bayside", ]
year_17 <- year_17[!year_17$location == "Blackwater Sound", ]
year_17 <- year_17[!year_17$location == "Benny Poo", ]
year_17 <- year_17[!year_17$location == "French Reef", ]
year_17 <- year_17[!year_17$location == "Deep Blue", ]
year_17 <- year_17[!year_17$location == "Marker 37", ]
year_17 <- year_17[!year_17$location == "Lagoon", ]
year_17 <- year_17[!year_17$location == "Tarpon Deep", ]
year_17 <- year_17[!year_17$location == "Mosquito", ]
year_17 <- year_17[!year_17$location == "Swash Keys", ]
year_17 <- year_17[!year_17$location == "Captain's Point", ]

year_17 <- year_17 %>% dplyr::select(-location)
year_17 <- scale(year_17)
year_17 <- as.data.frame(year_17)

```

```{r 2018}

year_18 <- year_18[!year_18$location == "Scott's Channel", ]
year_18 <- year_18[!year_18$location == "Sexton Cove", ]
year_18 <- year_18[!year_18$location == "Ocean Reef Club", ]
year_18 <- year_18[!year_18$location == "North North Dry Rocks", ]
year_18 <- year_18[!year_18$location == "NA", ]
year_18 <- year_18[!year_18$location == "Higdon's", ]
year_18 <- year_18[!year_18$location == "The Elbow", ]
year_18 <- year_18[!year_18$location == "The Barge", ]
year_18 <- year_18[!year_18$location == "Bayside", ]
year_18 <- year_18[!year_18$location == "Blackwater Sound", ]
year_18 <- year_18[!year_18$location == "Benny Poo", ]
year_18 <- year_18[!year_18$location == "French Reef", ]
year_18 <- year_18[!year_18$location == "Deep Blue", ]
year_18 <- year_18[!year_18$location == "Marker 37", ]
year_18 <- year_18[!year_18$location == "Lagoon", ]
year_18 <- year_18[!year_18$location == "Tarpon Deep", ]
year_18 <- year_18[!year_18$location == "Mosquito", ]
year_18 <- year_18[!year_18$location == "Swash Keys", ]
year_18 <- year_18[!year_18$location == "Buttonwood", ]
year_18 <- year_18[!year_18$location == "Captain's Point", ]

year_18 <- year_18 %>% dplyr::select(-location)
year_18 <- scale(year_18)
year_18 <- as.data.frame(year_18)


```

```{r 2019}

year_19 <- year_19[!year_19$location == "Scott's Channel", ]
year_19 <- year_19[!year_19$location == "Sexton Cove", ]
year_19 <- year_19[!year_19$location == "Ocean Reef Club", ]
year_19 <- year_19[!year_19$location == "North North Dry Rocks", ]
year_19 <- year_19[!year_19$location == "NA", ]
year_19 <- year_19[!year_19$location == "Higdon's", ]
year_19 <- year_19[!year_19$location == "The Elbow", ]
year_19 <- year_19[!year_19$location == "The Barge", ]
year_19 <- year_19[!year_19$location == "Bayside", ]
year_19 <- year_19[!year_19$location == "Blackwater Sound", ]
year_19 <- year_19[!year_19$location == "Benny Poo", ]
year_19 <- year_19[!year_19$location == "French Reef", ]
year_19 <- year_19[!year_19$location == "Deep Blue", ]
year_19 <- year_19[!year_19$location == "Marker 37", ]
year_19 <- year_19[!year_19$location == "Lagoon", ]
year_19 <- year_19[!year_19$location == "Tarpon Deep", ]
year_19 <- year_19[!year_19$location == "Mosquito", ]
year_19 <- year_19[!year_19$location == "Swash Keys", ]
year_19 <- year_19[!year_19$location == "Buttonwood", ]
year_19 <- year_19[!year_19$location == "Tarpon Island", ]
year_19 <- year_19[!year_19$location == "South Sound Creek", ]
year_19 <- year_19[!year_19$location == "Hidden Lake", ]
year_19 <- year_19[!year_19$location == "Captain's Point", ]

year_19 <- year_19 %>% dplyr::select(-location)
year_19 <- scale(year_19)
year_19 <- as.data.frame(year_19)
```

Phew lots of sorting, now we can start on our dendros.

We will make 2016 first.

```{r 2016 dend}
set.seed(1111)

fviz_nbclust(year_16, FUN = hcut, method = "silhouette")

clust_16 <- agnes(year_16, method = "ward")

good_adend_16 <- fviz_dend(clust_16, k = 2, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2016 Cluster Analysis agnes")

good_adend_16

dist_16 <- dist(year_16, method = "euclidean")
hclust_16 <- hclust(dist_16, method = "ward.D2")
dend_ready_16 <- as.dendrogram(hclust_16)

good_hdend_16 <- fviz_dend(hclust_16, k = 2, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2016 Cluster Analysis hclust")
good_hdend_16

```
Looks like the Grotto is very different from all other measures this year. Similarly, the boat ramp and Nest Key are quite distinct also.

Now for 2017!

```{r}
set.seed(1111)

fviz_nbclust(year_17, FUN = hcut, method = "silhouette")

clust_17 <- agnes(year_17, method = "ward")

good_adend_17 <- fviz_dend(clust_16, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2017 Cluster Analysis agnes")

good_adend_17

dist_17 <- dist(year_17, method = "euclidean")
hclust_17 <- hclust(dist_17, method = "ward.D2")
dend_ready_17 <- as.dendrogram(hclust_17)

good_hdend_17 <- fviz_dend(hclust_16, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2017 Cluster Analysis hclust")

good_hdend_17
```
2017 looks very similar to 2016, structurally with The Grotto, Boat Ramp, and Nest Key showing as the most distant from all other locations.

Next 2018

```{r}
set.seed(1111)

fviz_nbclust(year_18, FUN = hcut, method = "silhouette")

clust_18 <- agnes(year_18, method = "ward")

good_adend_18 <- fviz_dend(clust_18, k = 8, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2018 Cluster Analysis agnes")

good_adend_18

dist_18 <- dist(year_18, method = "euclidean")
hclust_18 <- hclust(dist_18, method = "ward.D2")
dend_ready_18 <- as.dendrogram(hclust_18)

good_hdend_18 <- fviz_dend(hclust_18, k = 8, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2018 Cluster Analysis hclust")

good_hdend_18
```

2018 is the most unique so far however, no distinct patterns are notable.

And finally 2019 
 
```{r}
set.seed(1111)

fviz_nbclust(year_19, FUN = hcut, method = "silhouette")

clust_19 <- agnes(year_19, method = "ward")

good_adend_19 <- fviz_dend(clust_19, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2019 Cluster Analysis")

good_adend_19

dist_19 <- dist(year_19, method = "euclidean")
hclust_19 <- hclust(dist_19, method = "ward.D2")
dend_ready_19 <- as.dendrogram(hclust_19)

good_hdend_19 <- fviz_dend(hclust_19, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "2019 Cluster Analysis")

good_hdend_19
```

2019 looks the most consistent with geographical location as the previous years however, this pattern is not seen in all sites.

Now we can build our tanglegrams. Tanglegrams compare the alignment of two dendrograms. The entanglement coefficent represents the degree by which the two samples are entangled (or improperly aligned). A low entanglemnt shows a good alignment whereas a high entanglement shows disalignment. 
```{r}

entang_16_17 <- dendlist(dend_ready_16, dend_ready_17)

tangle_16_17 <- tanglegram(dend_ready_16, dend_ready_17, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2016 vs. 2017 Entanglement =", round(entanglement(entang_16_17), 2)))
```



```{r}
entang_16_18 <- dendlist(dend_ready_16, dend_ready_18)

tangle_16_18 <- tanglegram(dend_ready_16, dend_ready_18, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2016 vs. 2018 Entanglement =", round(entanglement(entang_16_18), 2)))
```

```{r}
entang_16_19 <- dendlist(dend_ready_16, dend_ready_19)

tangle_16_19 <- tanglegram(dend_ready_16, dend_ready_19, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2016 vs. 2019 Entanglement =", round(entanglement(entang_16_19), 2)))
```

```{r}
entang_17_18 <- dendlist(dend_ready_17, dend_ready_18)

tangle_17_18 <- tanglegram(dend_ready_17, dend_ready_18, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2017 vs. 2018 Entanglement =", round(entanglement(entang_17_18), 2)))
```

```{r}
entang_17_19 <- dendlist(dend_ready_17, dend_ready_19)

tangle_17_19 <- tanglegram(dend_ready_17, dend_ready_19, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2017 vs. 2019 Entanglement =", round(entanglement(entang_17_19), 2)))
```

```{r}
entang_18_19 <- dendlist(dend_ready_18, dend_ready_19)

tangle_18_19 <- tanglegram(dend_ready_18, dend_ready_19, highlight_distinct_edges = FALSE, common_subtrees_color_branches = TRUE, lwd = 2, lab.cex = 1, main = paste("2018 vs. 2019 Entanglement =", round(entanglement(entang_18_19), 2)))
```

Based on the tanglegrams and entanglement measures it seems like MarineLab is not very consistent with measurement across multiple years. Only one of the tanglegrams (2016 vs. 2019) shows any alignment of nodes. Notably some of the greatest entanglement is seen in tanglegrams containing 2019, this my be the result of the fact that this data set ended before the fall of this year. 

While consistency may be a goal of sampling, it is important to note that this analysis does not account for any seasonal variation between sites and could show skewed values if a particualr site was only visited during a certian part of the year for one or more of the data subsets. Additionally, inconsistancy may also be a result of improving methods, training, or equipment over time. 

## Seasonal Clustering

### Questions for this section

_Which of the three representitive sites is more strongly influenced by seasonal changes_

Based on the poor entanglement measures of year-to-year comparison it may be more prudent to cluster data based on month collected rather than simply measuring specific sites across years due to annual and seasonal fluctuation. 

For this analysis we will use our most frequently visted sites for comparison of each of the three site types. Seagrass/Mangrove will be represented by Tarpon Basin, Patch Reef, Hardbottom will be represented by Rodriguez Key and Coral Reefs will be represented by Grecian Dry Rocks.

First we need to make our subsets.
```{r}
tarpon_only <- subset(WQ_clean_data, location == "Tarpon Basin")
grecian_only <- subset(WQ_clean_data, location == "Grecian Dry Rocks")
roddy_only <- subset(WQ_clean_data, location == "Rodriguez Key")

```

Next as above, we must clean our data, aggregate by means of Month, assin rownames, scale, and prep the dataframe.
```{r}
tarpon_reduce <- tarpon_only %>% dplyr::select(Month, water_temp, salinity, dissolved_oxygen, ammonia, ph)

tarpon_mean <- aggregate(. ~ Month, tarpon_reduce, mean)

rownames(tarpon_mean) <- tarpon_mean$Month

tarpon_drop_month <- tarpon_mean %>% dplyr::select(-Month)

tarpon_scale <- scale(tarpon_drop_month)

tarpon_ready <- as.data.frame(tarpon_scale)
```

Since these dendrograms will have less than 10 total bins we will need to modify our silhouete code as above using the NbClust. The fviz_nbclust function cannot handle datasets with less than 10 observations in the format as above, additionall we cannot produce the silhouette curves however, we can calculate the values.
```{r}
library(NbClust)
#In this function we must specify a min and mx number of clusters, we will use a min of two to get some information and a max of four to see if we can get seasonal clustering
tarpon_diss <-NbClust(tarpon_ready, distance = "euclidean", min.nc = 2, max.nc = 4, 
            method = "ward.D2", index = "silhouette")

#The best number of clusters calcuated by the value index
tarpon_diss$Best.nc
#the partition of observations into their respective clusters
tarpon_diss$Best.partition
```

Next we make the dendgrograms as above.
```{r}
set.seed(1111)


clust_tarpon_agnes <- agnes(tarpon_ready, method = "ward")

good_adend_tarpon <- fviz_dend(clust_tarpon_agnes, k = 2, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Tarpon Basin Seasonal Cluster Analysis (agnes)")

good_adend_tarpon

dist_tarpon <- dist(tarpon_ready, method = "euclidean")
hclust_tarpon <- hclust(dist_tarpon, method = "ward.D2")
dend_ready_tarpon <- as.dendrogram(hclust_tarpon)

good_hdend_tarpon <- fviz_dend(hclust_tarpon, k = 2, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Tarpon Basin Seasonal Cluster Analysis (hclust)")

good_hdend_tarpon
```
It looks like our data groups relatively close to a seasonal timeline. The closest clusters are often adjacent or near months. It appears October is a very different month from the rest of the samples, this may be due to the fact that September and November observations are absent so it is our only representitive of fall.

Next we will look at Rodriguez Key

```{r}
roddy_reduce <- roddy_only %>% dplyr::select(Month, water_temp, salinity, dissolved_oxygen, ammonia, ph)

roddy_mean <- aggregate(. ~ Month, roddy_reduce, mean)

rownames(roddy_mean) <- roddy_mean$Month

roddy_drop_month <- roddy_mean %>% dplyr::select(-Month)

roddy_scale <- scale(roddy_drop_month)

roddy_ready <- as.data.frame(roddy_scale)
```

```{r}
roddy_diss <- NbClust(roddy_ready, distance = "euclidean", min.nc = 2, max.nc = 4, 
            method = "ward.D2", index = "silhouette")

roddy_diss$Best.nc
roddy_diss$Best.partition
```
Lookd likr four clusters is best here!

```{r}
set.seed(1111)


clust_roddy_agnes <- agnes(roddy_ready, method = "ward")

good_adend_roddy <- fviz_dend(clust_roddy_agnes, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Rodriguez Key Seasonal Cluster Analysis (agnes)")

good_adend_roddy

dist_roddy <- dist(roddy_ready, method = "euclidean")
hclust_roddy <- hclust(dist_roddy, method = "ward.D2")
dend_ready_roddy <- as.dendrogram(hclust_roddy)

good_hdend_roddy <- fviz_dend(hclust_roddy, k = 4, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Rodriguez Key Seasonal Cluster Analysis (hclust)")

good_hdend_roddy
```
So it looks like our summer clustering is fairly strong, however the remainder of the months are not grouped in any notable pattern.

Last we will look at Grecian Dry Rocks

```{r}
grecian_reduce <- grecian_only %>% dplyr::select(Month, water_temp, salinity, dissolved_oxygen, ammonia, ph)

grecian_mean <- aggregate(. ~ Month, grecian_reduce, mean)

rownames(grecian_mean) <- grecian_mean$Month

grecian_drop_month <- grecian_mean %>% dplyr::select(-Month)

grecian_scale <- scale(grecian_drop_month)

grecian_ready <- as.data.frame(grecian_scale)
```


```{r}
grecian_diss <- NbClust(grecian_ready, distance = "euclidean", min.nc = 2, max.nc = 4, method = "ward.D2", index = "silhouette")

grecian_diss$Best.nc
grecian_diss$Best.partition
```
Three clusters for this subset.

```{r}
set.seed(1111)

clust_grecian_agnes <- agnes(grecian_ready, method = "ward")

good_adend_grecian <- fviz_dend(clust_grecian_agnes, k = 3, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Grecian Dry Rocks Seasonal Cluster Analysis (agnes)")

good_adend_grecian

dist_grecian <- dist(grecian_ready, method = "euclidean")
hclust_grecian <- hclust(dist_grecian, method = "ward.D2")
dend_ready_grecian <- as.dendrogram(hclust_grecian)

good_hdend_grecian <- fviz_dend(hclust_grecian, k = 3, show_labels = TRUE, cex = 0.5, rect = FALSE, color_labels_by_k = FALSE, horiz = TRUE, rect_lty = 5, rect_border = 8, main = "Grecian Rocks Seasonal Cluster Analysis (hclust)")

good_hdend_grecian
```

The clustering in this instance does not appear to show seasonal grouping. It should be noted that the two individual clusters July and December are the two most extreme seasonal months so it is possible their seperation may be due to seasonal extremes. However, the majority of months do not show a distinct pattern.

### Further Cluster Analysis Discussion

Through the use of hiearacical clustering and data subsets were were able to identify how closely related observations are to one another. Using site type cluster analysis we explored the distrubution of sampling sites under each of the three site types in the study. For Seagrass/Mangrove sites our data is fairly heterogeneous. These locaitons divided into 6 distinct clusters. No specific common attribute of the sites can explain the division pattern seen however, some notable differences and similarities appear to be correlated with geographic location (i.e. very different clusters contain sites which are far from all others whereas similar clusters are close in proximity). This pattern was not observed across all site locations. Path Reef/Hardbottom locations showed a very distinct spread across all of the sites with 6 clusters as ideal for a total of 7 sites. This suggests that these sites are the most distinct from one another. The two similar sites in the group Higdon's and Mosquito have very similar coral biota and depth ranges compared to all others. Coral reef analysis shows the least clustering of all of the site types, primairly divinding into the northernmost reefs (The Elbow and Ocean Reef Club) and all of the remaining southern reefs. This suggests that coral reefs are the least heterogenous of the three site types which is consistant previous analysis which show the narrowest range of abiotic conditions. 

_Which of the three site types (Seagrass/Mangrove, Patch Reef/Hardbottom, or Coral Reef) are the most homogeneous and heterogeneous?_
In terms of water quality parameters the most heterogeneous site types were Seagrass/Mangrove and Patch Reef/Hardbottom. The most homogeneous are Coral Reefs. This observation is  consistent with previous analyses which show a wider range of abiotic conditions in Seagrass/Mangrove sites and a narrower range in Coral Reefs.
_Are there any notable site patterns which might explain why the clusters are distributed in this manner?_
There is no discernable pattern that applies to all clustering situations that would explain the distribution. Large differences and samll differences may likely be attributable to site characteristics (geographic proximity, depth similarity, etc.) however, no one pattern explains all of the clustering. 

Annual clustering was used to determine the similarity between subsequent years of sampling. Dendrograms of sampling sites which were measured all four years were subsetted and compared using a tanglegram to calculate the level of entanglement. Greater entanglement shows a greater level of dissimilarity between years of sampling. This analysis suggests that year-to-year measures of water quality are not very consistentusing the MarineLab sampling techniques. Though the analysis suggests this, it is important to understand the limiations of this technique. Entanglement is dependant entirely on the structure of the respective dendrograms which are in turn dependant on the water quality parameters which feed into the model. This method is limited in its ability to assess this type of question because it cannot account for differences in seasonal flucutation, annual fluctuation, equipment optimization, training optimization, or other confounding factors. As a result we will determine the quesitons of this subsection to be inconclusive due to model limitations. The usage of a tanglegram/entanglment would be an applicable method to compare different samling teams who visited the same sites at the same time of year (inter-rater relatibility).

_How does our cluster analysis compare across sampling years?_
The results of cluster comparison across multiple years are inconclusive due to model restrictions. Upon deeper investigation of the entanglemnt calculations and model abilities, data is not comparable across multiple years due to the presence of confounding factors which cannot be eliminated using this modeling technique. The methodology would work as a comparison of inter-rater relatability for observers using the same methods.

Lastly, seasonal clustering investigated the grouping of Month groups when observed at the most frequently visited sampling sites of each of the three site types: Tarpon Basin, Grecian Dry Rocks, and Rodriguez Key. The results showed a seasonally organized clustering for Tarpon Basin which suggests that Seagrass/Mangrove sites are more strongly influenced by seasonal factors, this observation is consistent with previous analyses. Rodriguez Key showed a summer month cluster however the remaining clusters were not consistent with a seasonal pattern. Grecian Dry Rocks showed the least seasonally grouped clustering pattern of all three sites which suggests that coral reefs are least influenced by seasonal fluctuation.  

_Which of the three representitive sites is more strongly influenced by seasonal changes_
Based on month-wise clustering, Tarpon Basin is the site which is most strongly influenced by seasonal flucutation in water quality. This result suggests that Seagrass/MAngrove sites are strongly influenced by seasonal change. Patch Reefs/Hardbottom sites appear to be moderately influenced and Coral Reefs are influenced the least. 

### Revisiting Analysis Questions

_How do sampling sites cluster based on individual water quality measurements?_ 
Overall sampling sites do not cluster with any discernable pattern that is applicable for the entire data set. Individual subsets of the data can show specific clustering patterns that may be attributable to season, year, geographical distance, or local biota however; these atrributes are inferences based on individual dendrograms and do not apply to the entire data set.

_Are there any site-wise, annual, and/or seasonal patterns that can be identified based on cluster analysis?_ 
Based on cluster analysis, it was observed that Seagrass/Mangrove sites are the most heterogeneous sites in terms of water quality. Patch Reefs/Hardbottom were moderate and Coral Reefs were the most homogenous. Additionally, Seagrass/Mangrove sites are the most influenced by seasonal fluctuation, Patch Reefs/Hardbottom are moderately influenced, and Coral Reefs are the least influenced. 


### Pros and Cons of Hierarchical Clustering
_Pros_
1. Hierarchical cluster analysis is applicable to datasets without a predetermined outcome. This is ideal for exploratory data, monitoring, or taxanomic grouping research. 
2. There are multiple options for analysis algorithms and methods which can be optimized for individual data sets. For this data set we experimented with a number of methods but found our optimal model approach used agglomerative clustering with Ward's minimum variance. Optimal cluster number was determined using the silhouette method (though the Elbow method was equivlant in all cases as well). 
3. Hierarchical clustering allows for a dynamic analysis approach to modeling. A large dendrogram can be made to visualize gross patterns in the data which can then be subsestted to investigate individual categories/parameters/timeframes of interest. 
_Cons_ 
1. Hierarchical clustering will only show the resulting clusters that observations have been assigned to, it does not provide any evidence as to why these clusters were desginated. 
2. Dendrograms are not comparable between one another unless they conatin data which are replicates of the data in another dendrogram (i.e. they cannot control for confounding factors when comparing).
3. Cluster analysis (in general) is relatively slow compared to other modeling methods especially when larger datasets are in use. 
4. Since there is no specific outcome for hierarchical clustering, if the resulting analysis does not show any informative information (through clustering patterns) it is likely the results of the analysis will not be useful to the research.
5. Hierarchical clustering cannot handle any predictor variables which are categorical. The cluster results can be categorical (as done here) but must be assigned to the rownames and removed from the data frame. 

